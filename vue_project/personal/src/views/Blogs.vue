<template>
  <div class="blogs">
    <Sidebar></Sidebar>
    <!-- <img src="../assets/img/105.jpg" alt=""> -->
    <div class="content">
      <HeaderTitle>
        <template #first>BLOG</template>
        <template #first-light>OG</template>
        <template #second>有关网页设计和开发的技巧</template>
      </HeaderTitle>
      <div class="swiper-container">
        <!-- <ul class="swiper-wrapper" style="background:url(../assets/img/104.jpg)">
          <li class="swiper-slide" v-for="(item,index) in swiperItems" :key="index">
            <span>{{item}}</span>
          </li>

        </ul>-->
        <ul class="swiper-wrapper">
          <li class="swiper-slide" v-for="(item,index) in swiperItems" :key="index">
            <img :src="item" alt="">
          </li>
          <li class="swiper-slide">
          </li>
        </ul>
        <ul class="swiper-pagination">
          <li
            v-for="(item,index) in swiperItems"
            :key="index"
            @click="switchSwiper(index)"
            :class="[index===swiperCurrentItemIndex ? 'active' : '']"
          ></li>
        </ul>
        <!-- nextItemIndex, interaction -->
        <div
          class="swiper-button-prev"
          @click="throttle({'fn':prevPic,'nextItemIndex':swiperCurrentItemIndex-1,'interaction':true})"
        >
          <i class="fa fa-angle-left" aria-hidden="true"></i>
        </div>
        <div
          class="swiper-button-next"
          @click="throttle({'fn':nextPic,'nextItemIndex':swiperCurrentItemIndex+1,'interaction':true})"
        >
          <i class="fa fa-angle-right" aria-hidden="true"></i>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import Sidebar from "../components/Sidebar";
import HeaderTitle from "../components/HeaderTitle";
export default {
  components: {
    Sidebar,
    HeaderTitle
  },
  data: function() {
    return {
      swiperItems: [
        require("../assets/img/1.jpeg"),
        require("../assets/img/2.jpeg"),
        require("../assets/img/3.jpeg"),
      ],
      // 轮播元素
      // 动画基准值
      baseChange: 60,
      // 轮播项宽度
      swiperItemWidth: null,
      // 当前轮播项
      swiperCurrentItemIndex: 0,
      // 轮播包
      swiperWrapper: null,
      // 轮播缓存项
      swiperCacheItems: null,
      // 计时器
      timer: null,
      // 上一访问事件
      prevTime: null,
      // 节流限制时间
      throttlingLimit: 1000
    };
  },
  methods: {
    // 轮播小点点点击
    switchSwiper(index) {
      // 判断前后
      if (index > this.swiperCurrentItemIndex) {
        this.throttle({
          fn: this.nextPic,
          nextItemIndex: index,
          interaction: true
        });
      } else if (index < this.swiperCurrentItemIndex) {
        this.throttle({
          fn: this.prevPic,
          nextItemIndex: index,
          interaction: true
        });
      } else {
        return;
      }
    },
    // 节流函数
    throttle: function({ fn, nextItemIndex, interaction }) {
      // 清除计时器
      if (interaction) {
        clearInterval(this.timer);
      }
      // 节流
      if (Date.now() > this.prevTime + this.throttlingLimit) {
        this.prevTime = Date.now();
        fn(nextItemIndex, interaction);
      }
    },

    // 自动轮播
    autoPlay() {
      this.timer = setInterval(() => {
        this.throttle({
          fn: this.nextPic,
          nextItemIndex: this.swiperCurrentItemIndex + 1,
          interaction: false
        });
      }, this.throttlingLimit + 2000);
    },
    // 上一张
    prevPic: function(nextItemIndex, interaction) {
      var nextItem;
      // 当前项调整
      if (nextItemIndex < 0) {
        this.swiperCurrentItemIndex = this.swiperCacheItems.length - 1;
      } else {
        this.swiperCurrentItemIndex = nextItemIndex;
      }
      nextItem = this.swiperCacheItems[this.swiperCurrentItemIndex];

      // 获取当前轮播项
      var swiperItems = this.$el.querySelectorAll(
        ".swiper-wrapper .swiper-slide"
      );
      // 动画准备
      this.swiperWrapper.insertBefore(nextItem, swiperItems[0]);
      this.swiperWrapper.style.left = `-${this.swiperItemWidth}px`;
      var left = -this.swiperItemWidth;

      // 动画
      var timer = setInterval(() => {
        // 动画限制
        if (left < 0) {
          left += this.baseChange;
          this.swiperWrapper.style.left = `${left}px`;
        } else {
          // 清除动画定时器
          clearInterval(timer);

          if (interaction) {
            // 自动轮播
            this.autoPlay();
          }
        }
      }, 30);
    },
    // 展示下一张
    nextPic: function(nextItemIndex, interaction) {
      var nextItem;
      // 轮播项调整
      if (nextItemIndex > this.swiperCacheItems.length - 2) {
        this.swiperCurrentItemIndex = 0;
      } else {
        this.swiperCurrentItemIndex = nextItemIndex;
      }
      nextItem = this.swiperCacheItems[this.swiperCurrentItemIndex];

      // 获取当前轮播各项
      var swiperItems = this.$el.querySelectorAll(
        ".swiper-wrapper .swiper-slide"
      );
      // 动画准备
      this.swiperWrapper.insertBefore(nextItem, swiperItems[0]);
      this.swiperWrapper.insertBefore(swiperItems[0], nextItem);
      var left = 0;
      // 动画
      var timer = setInterval(() => {
        // 动画限制
        if (left > -this.swiperItemWidth) {
          left -= this.baseChange;
          this.swiperWrapper.style.left = `${left}px`;
        } else {
          // 清除动画定时器
          clearInterval(timer);
          this.swiperWrapper.style.left = `0px`;
          this.swiperWrapper.appendChild(swiperItems[0]);
          if (interaction) {
            this.autoPlay();
          }
        }
      }, 30);
    }
  },
  mounted() {
    this.swiperPagination = this.$el.querySelectorAll(".swiper-pagination li");
    this.swiperWrapper = this.$el.querySelector(".swiper-wrapper");
    this.swiperCacheItems = this.$el.querySelectorAll(
      ".swiper-wrapper .swiper-slide"
    );
    this.swiperItemWidth = this.swiperCacheItems[0].offsetWidth;

    //
    this.autoPlay();
  }
};
</script>

<style lang="less" scoped>
// 通用样式
.block-vertical-center() {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
}

.content {
  padding: 16px;
  .l-r-s();
  position: relative;
  .swiper-container {
    height: 500px;
    background: #0000ff;
    overflow: hidden;
    position: relative;
    .swiper-wrapper {
      width: 1000%;
      display: flex;
      flex-wrap: nowrap;
      position: relative;
      li.swiper-slide {
        width: 10%;
        img{
          width: 100%;
        }
      }
    }
    ul.swiper-pagination {
      position: absolute;
      bottom: @p-s;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      justify-content: space-around;
      width: 200px;
      li {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: @gray;
        &.active {
          background: @yellow;
        }
      }
    }
    .control() {
      .block-vertical-center();
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: @yellow;
      i {
        &::before {
          font-size: 36px;
          color: #ffffff;
        }
      }
    }
    .swiper-button-prev {
      .control();
      left: 0;
    }
    .swiper-button-next {
      .control();
      right: 0;
    }
  }
}
</style>