<template>
  <div class="hot">
    <PlayBar></PlayBar>
    <HomeLink></HomeLink>
    <LoadingComp></LoadingComp>
    <div class="poster">
      <div class="poster-content"></div>
    </div>
    <ul class="songItem-innter-layout">
      <SongItem
        v-for="(item, index) in hotSongListDetail"
        :key="index"
        :songItem="item"
        :number="index"
        :showNumber="true"
      ></SongItem>
    </ul>
    <PageBase></PageBase>
  </div>
</template>

<script>
import { mapState, mapMutations, mapActions } from "vuex";
import cache from "../assets/js/cache";
import api from "../api/api";
import types from "../store/modules/types";

import PlayBar from "../components/PlayBar.vue";
import HomeLink from "../components/HomeLink.vue";
import SongItem from "../components/SongItem.vue";
import LoadingComp from "../components/LoadingComp.vue";
import PageBase from "../components/PageBase.vue";
export default {
  name: "Hot",
  components: {
    HomeLink,
    SongItem,
    LoadingComp,
    PageBase,
    PlayBar,
  },
  computed: {
    ...mapState(["err", "currentSong"]),
    ...mapState("hot", ["hotSongListDetail"]),
  },
  methods: {
    ...mapMutations([`${types.UPDATE}`]),
    ...mapActions({
      [`action${types.UPDATE}`]: `${types.UPDATE}`,
    }),
  },
  created() {
    cache.init(
      "hotSongListDetail",
      () => {
        this.UPDATE({
          key: "hotSongListDetail",
          value: cache.parse("hotSongListDetail"),
          name: "hot",
        });
        // 更新热歌数据
      },
      () => {
        this.UPDATE({ key: "showLoading", value: true });
        // loading交互

        this.axios
          .get(api.hot.hotSongs)
          .then((res) => {
            this.UPDATE({
              key: "hotSongListDetail",
              value: res.data.playlist.tracks,
              name: "hot",
            });

            // 网络请求热歌数据
            localStorage.setItem(
              "hotSongListDetail",
              JSON.stringify({
                expires: Date.now() + 60 * 10000,
                data: res.data.playlist.tracks,
              })
            );
            // 更新缓存
            this.UPDATE({ key: "showLoading", value: false });
          })
          .catch((err) => {
            this.UPDATE({ key: "err", value: err });
            // 报错提示
          });
        // loading交互
      }
    );
    // 获取热歌数据
  },
};
</script>

<style lang="less">
@red: #dd001b;

.hot {
  padding-top: 38px;
  padding-bottom: 70px;
  .poster {
    height: 122px;
    background: url(../assets/images/hot_music_bg_2x.jpg);
    background-size: 100% auto;
    position: relative;
    width: 100%;
    overflow: hidden;
    .poster-content {
      min-width: 576px;
      background: url(../assets/images/index_icon_2x.png) no-repeat #d78862de;
      background-size: contain;
      width: 100%;
      height: 100%;
    }
  }
  .songItem-innter-layout {
    padding: 0 15px;
    .song-item:nth-of-type(-n + 3) {
      .song-number {
        color: @red;
      }
    }
  }
}
</style>
