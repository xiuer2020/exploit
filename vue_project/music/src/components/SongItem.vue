<template>
  <li class="song-item" @click.stop="switchCurrentSong(songItem)">
    <div class="left">
      <div class="song-introduction-box">
        <div
          class="song-number"
          v-if="showNumber"
          :class="{ active: number < 3 }"
        >
          {{ numberComputed }}
        </div>
        <!-- 序号 -->
        <div class="song-introduction">
          <div class="song-name">
            {{ songItem.name }}
            <!-- 歌曲名 -->
            {{ songAlia }}
            <!-- 歌唱者 -->
          </div>
          <div class="song-artists">{{ songItemArtists }}</div>
          <!-- 歌唱者 -->
        </div>
      </div>
    </div>
    <div class="right">
      <img
        src="../assets/images/playing.svg"
        alt
        class="icon icon-play"
        style="background: none"
        v-if="currentSong.id === songItem.id && playing"
      />
      <i class="fa fa-play-circle-o" v-else></i>
    </div>
  </li>
</template>

<script>
import { mapState, mapMutations, mapActions } from "vuex";
import types from "@/store/modules/types";
export default {
  name: "SongItem",
  props: {
    number: {
      type: Number,
      default: 0,
    },
    songItem: {
      type: Object,
      default: () => ({}),
    },
    showNumber: {
      type: Boolean,
      default: false,
    },
  },
  computed: {
    ...mapState(["currentSong", "err", "playing", "currentSongList"]),
    numberComputed: function () {
      return this.number < 9 ? `0${this.number + 1}` : this.number + 1;
    },
    // 序号

    songItemArtists: function () {
      if (this.songItem.song) {
        return this.songItem.song.artists
          .map((artist) => artist.name)
          .join("/");
      } else if (this.songItem.ar) {
        return this.songItem.ar.map((artist) => artist.name).join("/");
      } else {
        return "";
      }
    },
    // 歌唱者

    songAlia: function () {
      if (this.songItem.alia) {
        return this.songItem.alia.join("-");
      } else {
        return "";
      }
    },
    // 歌唱者
  },
  methods: {
    ...mapMutations([types.UPDATE]),
    ...mapActions({
      [`action${types.UPDATE}`]: `${types.UPDATE}`,
    }),
    switchCurrentSong: function (songItem) {
      this.UPDATE({
        key: "currentSong",
        value: songItem,
      });
      // 更新当前播放歌曲

      this.UPDATE({
        key: "currentSongListIndex",
        value: -1,
      });
      // 更新当前播放歌曲列表下标

      if (this.currentSong.id === songItem.id) {
        // 是否点击当前播放歌曲

        this.UPDATE({ key: "playing", value: !this.playing });
        // 更新playing
      } else {
        // 是否点击当前播放歌曲

        this.UPDATE({ key: "playing", value: true });
        // 更新playing
      }

      let currentSongList = this.currentSongList.filter((i) => {
        if (i) {
          return i.id !== songItem.id;
        } else {
          return false;
        }
      });
      // 去重

      this.UPDATE({
        key: "currentSongList",
        value: [...currentSongList, this.currentSong],
      });
      // 更新前播放列表
    },
  },
};
</script>

<style lang="less" scoped>
.song-item {
  display: flex;
  justify-content: space-between;

  font-size: 0.16rem;
  color: @c-b;
  line-height: 0.25rem;

  border-bottom: 0.01rem solid #f5f5f5;
  .left {
    width: 80%;
    .song-introduction-box {
      display: flex;
      width: 100%;
      margin-left: @s-lr;
      .song-number {
        margin-right: @s-lr;

        line-height: 0.41rem;
        &.active {
          color: @c-r;
        }
      }

      .song-introduction {
        width: 100%;
        .song-name {
          margin-right: @s-lr;
          height: 0.25rem;
          width: 100%;
          line-height: 0.25rem;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: nowrap;
        }
        .song-artists {
          line-height: 0.18rem;
          font-size: 0.12rem;
          color: @c-g;
        }
      }
    }
  }
  .right {
    i,
    img {
      color: @c-g;
      line-height: 0.41rem;

      width: 0.22rem;
    }
  }
}
</style>
