<template>
  <div class="business app-view">
    <div class="container business-form">
      <div class="app-name">{{ appName }}</div>
      <!-- 项目标题 -->
      <component :is="currentBusinessForm"></component>
      <!-- 动态展示表单 登录/注册 -->
    </div>
    <!-- 用户表单 -->

    <MsgBox></MsgBox>
    <!-- 消息提示组件 -->
  </div>
  <!-- 商家页面 -->
</template>

<script>
//导入表单验证文件
import { validForm } from "../assets/js/validForm";

//导入消息提示组件
import MsgBox from "../components/MsgBox";
import Register from "../components/Register";
import Vue from "vue";
import { universal } from "../assets/js/universal";

import { mapState } from "vuex";

export default {
  name: "Business",
  components: {
    Register,
    MsgBox
  },

  computed: {
    ...mapState("staticData", ["appName"]),
    // 静态
    ...mapState("dynamicData", [
      "currentBusinessForm",
      // 展示登录/注册表单
      "businessInfo",
      // 商家信息
      "codeHandlePrompt",
      // 验证码操作提示
      "codeIsSend"
      // 验证码是否发送
    ])
    // 动态
  },
  methods: {
    getCode() {
      //验证邮箱格式是否正确
      let data = { email: this.userInfo.email };
      let res = validForm.valid(data);
      if (res.pass === false) {
        // this.$showToast({
        //   message: res.msg,
        //   duration: 3000
        // });

        return;
      }

      let time = 5;
      this.text = `${time}s后重新发送`;
      this.isSend = true;
      let timer = setInterval(() => {
        if (time == 0) {
          clearInterval(timer);
          timer = null;
          this.text = `发送邮箱验证码`;
          this.isSend = false;
        } else {
          time--;
          this.text = `${time}s后重新发送`;
        }
      }, 1000);

      //发送邮箱验证码
      universal.request("POST", "/sendmail", data, result => {});
    },
    //获取邮箱验证码

    register() {
      this.$showToast({ message: "jjj" });

      //表单验证
      let result = validForm.valid(this.userInfo);
      if (result.pass === false) {
        // this.$showToast({
        //   message: result.msg,
        //   duration: 3000
        // });

        return;
      }

      //发起注册请求
      // universal.request("POST", "/register", this.userInfo, result => {
      //   if (result.data.code == 1000) {
      //     this.goLogin();
      //   } else {
      //     // this.$showToast({
      //     //   message: result.data.msg
      //     // });
      //   }
      // });
    },
    //注册

    goLogin() {
      this.$router.push({ name: "Login" });
    }
    //跳转登录
  }
};
</script>

<style lang="less" scoped>
// 响应式布局
.business {
  background: url("../assets/images/bg.jpg") no-repeat center center;
  background-size: cover;
  overflow-y: auto;

  .business-form {
    margin-top: 8.8vw;
    min-height: 100vh;
    // 响应式

    .app-name {
      font-size: 3vw;
      // 响应式
      font-weight: 900;
      color: #fff;
      text-align: center;
    }
    // 项目标题
  }
}
// 注册页面
@media (min-width: 992px) {
  .business {
    .business-form {
      margin-top: 0;
      // 兼容
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 40px 0;
      align-items: center;
    }
  }
}
</style>