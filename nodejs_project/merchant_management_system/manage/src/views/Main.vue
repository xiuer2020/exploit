<template>
  <div class="main app-view">
    <div class="header">
      <div class="fl title">商品管理系统</div>
      <div class="fr clearfix">
        <div class="user-img fl">
          <img class="auto-img" :src="staticUrl + '/' + businessInfo.userImg" alt />
        </div>
        <div class="nickname fl">{{ businessInfo.nickName }}</div>
        <div class="fl logout" @click="logout">退出</div>
      </div>
    </div>
    <!-- 头部 -->
    <div class="router-outer-layout">
      <div class="aside">
        <div class="asideMenu" v-for="(item, index) in asideMenu" :key="index">
          <div class="title">
            {{ item.title }}
          </div>
          <div
            class="sub-title-inner-layout"
            v-for="(x, y) in item.subTitle"
            :key="y"
          >
            <div class="sub-title">{{ x.name }}</div>
          </div>
        </div>
        <!-- 手风琴 -->
      </div>
      <!-- 侧边栏 -->
      <div class="router-inner-layout">
        <!-- 二级路由 -->
        <router-view></router-view>
      </div>
    </div>
    <BaseMsg></BaseMsg>
    <!-- 提示组件 -->
  </div>
  <!-- 主布局 -->
</template>



<script>
import { mapMutations, mapState } from "vuex";
export default {
  name: "Main",
  computed:{
    ...mapState("dynamicData", ["asideMenu", "businessInfo"])
  },
  methods: {
    ...mapMutations("dynamicData", ["update"]),
    // update 更新数据
    logout: function(){
      this.$cookies.remove("_abc");
      // 移除cookies
      this.$router.push({ name: "Login" });
      // 跳转商家登录页
    }
    // 注销
  },

  created() {

    this.axios({
      method: "GET",
      url: "/businessInfo"
    })
      .then(res => {
        if (res.data.code == 1060) {
          this.update({key: "businessInfo", value: res.data.result})
        }
      })
      .catch(err => {
        console.log(err);
      });
  }
};
</script>

<style lang="less" scoped>
.main {
  .header {
    height: 80px;
    background-color: #1470d7;
    position: sticky;
    top: 0;
    padding: 0 20px;
    color: #fff;
    line-height: 80px;
    .title {
      font-size: 24px;
    }
    // app标题
    .user-img {
      width: 60px;
      height: 60px;
      margin-top: 10px;
      border-radius: 50%;
      background-color: #fff;
      overflow: hidden;
    }
    .nickname {
      margin-left: 20px;
    }
    .logout {
      margin: 0 20px;
      cursor: pointer;
    }
  }
  // 头部
  .router-outer-layout {
    .aside {
      position: fixed;
      left: 0;
      top: 80px;
      bottom: 0;
      width: 200px;
      background-color: #1470d7;
      .asideMenu {
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        color: #fff;
        line-height: 44px;
        text-align: center;
        .title {
          background-color: #0d5ab2;
          font-weight: 900;
        }
        .sub-title-inner-layout {
          .sub-title {
            background: #0e54a5;
            border-bottom: 1px solid #094992;
            &.active {
              color: #c33333;
            }
          }
        }
      }
    }
    // 侧边栏
    .router-inner-layout {
      width: calc(100% - 200px);
      margin-left: 200px;
      background-color: #fff;
      padding: 20px;
    }
    // 二级路由
  }
}
// 主布局
</style>