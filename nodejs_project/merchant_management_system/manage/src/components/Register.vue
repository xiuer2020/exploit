<template>
  <div class="form-group-inner-layout register">
    <div class="form-group clearfix">
      <label class="fl form-title" :for="email">邮箱</label>
      <!-- 字段头 -->
      <div class="fl form-input">
        <input
          type="text"
          class="form-control"
          id="email"
          autocomplete="off"
          v-model="email"
          placeholder="请输入邮箱"
        />
      </div>
      <!-- 输入字段 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group clearfix">
      <label class="fl form-title" for="nickname">昵称</label>
      <!-- 字段头 -->
      <div class="fl form-input">
        <input
          type="text"
          class="form-control"
          id="nickname"
          autocomplete="off"
          v-model="nickName"
          placeholder="昵称1-10个字符"
        />
      </div>
      <!-- 输入字段 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group clearfix">
      <label class="fl form-title" for="password">密码</label>
      <!-- 字段头 -->
      <div class="fl form-input">
        <input
          type="text"
          class="form-control"
          id="password"
          autocomplete="off"
          v-model="passWord"
          placeholder="密码6-16个字符"
        />
      </div>
      <!-- 输入字段 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group clearfix">
      <label class="fl form-title" for="code">验证码</label>
      <!-- 字段头 -->
      <div class="fl form-input valid-form-input">
        <input
          type="text"
          class="form-control"
          id="code"
          autocomplete="off"
          v-model="code"
          placeholder="请输入六位验证码"
        />
      </div>
      <!-- 输入字段 验证码-->

      <div class="valid-code fl">
        <button
          class="btn btn-secondary btn-block"
          :disabled="codeIsSend"
          @click="getCode"
        >
          {{ codeHandlePrompt }}
        </button>
      </div>
      <!-- 验证状态 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group clearfix">
      <div class="valid-box">
        <span>将滑块拖动到最右边</span>
        <div class="mask"></div>
      </div>
      <!-- 滑块 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group form-btn-box">
      <div class="btn-box">
        <button class="btn btn-primary btn-block" @click="register">
          注册
        </button>
      </div>
      <!-- 提交按钮行 -->
      <div class="clearfix login-text">
        <span class="fr" @click="goLogin">已有账号，立即登录</span>
      </div>
      <!-- 登录链接 -->
    </div>
    <!-- 提交按钮盒子 -->
  </div>
  <!-- 注册表单 -->
</template>

<script>
//导入表单验证文件
import { validForm } from "../assets/js/validForm";

//导入消息提示组件
import MsgBox from "../components/MsgBox";
import Register from "../components/Register";
import Vue from "vue";
import { universal } from "../assets/js/universal";

import { mapState, mapMutations } from "vuex";

export default {
  name: "Register",

  computed: {
    ...mapState("staticData", ["appName"]),
    // 静态
    ...mapState("dynamicData", [
      "businessInfo",
      // 商家信息
      "codeHandlePrompt",
      // 验证码操作提示
      "codeIsSend"
      // 验证码是否发送
    ]),
    // 动态
    email: {
      get() {
        return this.$store.state.dynamicData.businessInfo.email;
      },
      set(v) {
        this.twoWayBind({ key: "email", value: v, name: "businessInfo" });
      }
    },
    // vuex双向绑定 邮箱
    nickName: {
      get() {
        return this.$store.state.dynamicData.businessInfo.nickName;
      },
      set(v) {
        this.twoWayBind({
          key: "nickName",
          value: v,
          name: "businessInfo"
        });
      }
    },
    // vuex双向绑定 昵称
    passWord: {
      get() {
        return this.$store.state.dynamicData.businessInfo.passWord;
      },
      set(v) {
        this.twoWayBind({
          key: "passWord",
          value: v,
          name: "businessInfo"
        });
      }
    },
    // vuex双向绑定 密码
    code: {
      get() {
        return this.$store.state.dynamicData.businessInfo.code;
      },
      set(v) {
        this.twoWayBind({ key: "code", value: v, name: "businessInfo" });
      }
    }
    // vuex双向绑定 验证码
  },
  methods: {
    ...mapMutations("dynamicData", ["twoWayBind"]),
    getCode() {
      //验证邮箱格式是否正确
      let data = { email: this.businessInfo.email };
      let res = validForm.valid(data);
      if (res.pass === false) {
        // this.$showToast({
        //   message: res.msg,
        //   duration: 3000
        // });

        return;
      }

      let time = 5;
      this.codeHandlePrompt = `${time}s后重新发送`;
      this.codeIsSend = true;
      let timer = setInterval(() => {
        if (time == 0) {
          clearInterval(timer);
          timer = null;
          this.codeHandlePrompt = `发送邮箱验证码`;
          this.codeIsSend = false;
        } else {
          time--;
          this.codeHandlePrompt = `${time}s后重新发送`;
        }
      }, 1000);

      //发送邮箱验证码
      universal.request("POST", "/sendmail", data, result => {});
    },
    //获取邮箱验证码

    register() {
      this.$showToast({ message: "jjj" });

      //表单验证
      let result = validForm.valid(this.businessInfo);
      if (result.pass === false) {
        // this.$showToast({
        //   message: result.msg,
        //   duration: 3000
        // });

        return;
      }

      //发起注册请求
      // universal.request("POST", "/register", this.businessInfo, result => {
      //   if (result.data.code == 1000) {
      //     this.goLogin();
      //   } else {
      //     // this.$showToast({
      //     //   message: result.data.msg
      //     // });
      //   }
      // });
    },
    //注册

    goLogin() {
      this.$router.push({ name: "Login" });
    }
    //跳转登录
  },
  created() {
    console.log("this.$store ==> ", this.$store);
  }
};
</script>


<style lang="less" scoped>
.form-group-inner-layout {
  margin-top: 4vw;
  // 响应式
  background-color: #fff;
  padding: 15px;
  border-radius: 10px;

  .form-title {
    width: 60px;
    height: 40px;
    line-height: 38px;
  }
  // 字段头
  .form-input {
    width: calc(100% - 60px);
    vertical-align: middle;
    display: inline-block;
  }

  .valid-code {
    width: 140px;
  }
  // 验证码状态

  .valid-form-input {
    width: 160px;
    margin-right: 20px;
  }
  // 验证码输入字段
  .valid-box {
    position: relative;
    height: 38px;
    margin-left: 80px;
    background-color: #ddd;
    text-align: center;
    line-height: 38px;
    user-select: none;
    span {
      color: #fff;
    }
    .mask {
      position: absolute;
      left: 0;
      top: 0;
      width: 60px;
      height: 100%;
      background-color: #e4393c;
      cursor: pointer;
    }
  }
  // 滑块
  .form-btn-box {
    margin-top: 40px;
    margin-bottom: 0;
    .btn-box {
      margin-left: 80px;
    }
    .login-text {
      margin-top: 20px;
      color: #444;
      cursor: pointer;
    }
  }
  // 提交
}
// 注册表单

@media (min-width: 992px) {
  .form-group-inner-layout {
    margin-top: 0;
    // 兼容
  }
}
</style>