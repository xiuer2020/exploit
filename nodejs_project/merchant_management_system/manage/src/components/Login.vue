<template>
  <div class="form-group-inner-layout longin">
    <div class="form-group clearfix">
      <label class="fl form-title" for="email">邮箱</label>
      <!-- 标题字段 -->
      <div class="fl form-input">
        <input
          type="text"
          class="form-control"
          id="email"
          autocomplete="off"
          v-model="email"
          placeholder="请输入邮箱"
        />
      </div>
      <!-- 输入字段 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group clearfix">
      <label class="fl form-title" for="password">密码</label>
      <!-- 标题字段 -->
      <div class="fl form-input">
        <input
          type="password"
          class="form-control"
          id="password"
          autocomplete="off"
          v-model="passWord"
          placeholder="密码6-16个字符"
        />
      </div>
      <!-- 输入字段 -->
    </div>
    <!-- 表单行 -->

    <div class="form-group form-btn-box">
      <div class="btn-box">
        <button class="btn btn-primary btn-block" @click="login">
          登录
        </button>
      </div>

      <div class="clearfix login-text">
        <span class="fl" @click="goRegister">没有账号，立即注册</span>
        <span class="fr">找回密码</span>
      </div>
    </div>
    <!-- 表单行 -->
  </div>
  <!-- 登录表单 -->
</template>

<script>
import { mapGetters, mapMutations } from "vuex";
import validForm from "../assets/js/validForm";
//导入表单验证类实例

export default {
  name: "Login",
  computed: {
    ...mapGetters("dynamicData", ["loginInfo"]),
    // loginInfo: 登录信息
    email: {
      get() {
        return this.$store.state.dynamicData.email;
      },
      set(v) {
        this.$store.state.dynamicData.email = v;
      }
    },
    // vuex双向绑定 邮箱

    passWord: {
      get() {
        return this.$store.state.dynamicData.passWord;
      },
      set(v) {
        this.$store.state.dynamicData.passWord = v;
      }
    }
    // vuex双向绑定 密码
  },
  methods: {
    ...mapMutations("dynamicData", ["showTips"]),
    // showTips 展示提示
    login() {
      //表单验证
      let result = validForm.valid(this.loginInfo);
      if (result.pass === false) {
        this.showTips(result.msg);
        return;
      }

      this.axios({
        method: "post",
        url: "/login",
        data: this.loginInfo
      }).then(res => {
        if(res.data.code === 1020){
          this.$router.push({ name: "Type" });
          this.$cookies.set(`_abc`, res.data.token)
        }
        // 登录成功后设置cookies
        console.log(this);
      })
      //发起登录请求

    },

    //跳转到注册
    goRegister() {
      this.$router.push({ name: "Register" });
    }
  },

  created() {}
};
</script>

<style lang="less" scoped>
.form-group-inner-layout {
  margin-top: 4vw;
  min-width: 440px;
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  .form-title {
    display: block;
    width: 80px;
    height: 38px;
    line-height: 38px;
  }
  // 标题字段

  .form-input {
    width: calc(100% - 80px);
  }
  // 输入字段

  .form-btn-box {
    margin-top: 40px;
    margin-bottom: 0;
    .btn-box {
      margin-left: 80px;
    }
    // 登录按钮
    .login-text {
      margin-top: 20px;
      color: #444;
      cursor: pointer;
      margin-left: 80px;
    }
    // 辅助信息
  }
}
// 登录表单
</style>