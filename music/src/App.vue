<template>
  <!-- <div id="app" @touchstart.stop="touchstart" @touchend.stop="touchend"> -->
  <div id="app">
    <router-view></router-view>
    <!-- 一级路由出口 -->

    <audio :src="currentSongUrl" controls height="30" width="100"></audio>
  </div>
</template>
<script>
import { mapState, mapMutations, mapGetters } from "vuex";
import types from "@/store/modules/types.js";

export default {
  computed: {
    ...mapState(["playing", "err", "currentSong"]),
    ...mapState("app", ["touchstartX", "differX"]),
    ...mapGetters(["currentSongUrl", "currentSongDuration"]),
  },
  watch: {
    playing: function (v) {
      var audio = this.$el.querySelector("audio");
      if (v) {
        let timer = setInterval(() => {
          if (audio.readyState) {
            audio.play();
            clearInterval(timer);
          }
        }, 1000);
      } else {
        audio.pause();
      }
      // playing 映射播放器播放状态
    },

    currentSong: function () {
      this.UPDATE({ key: "playing", value: true });
      // 更新 playing 配合playing映射
      var audio = this.$el.querySelector("audio");
      let timer = setInterval(() => {
        if (audio.readyState) {
          audio.play();
          clearInterval(timer);
        }
      }, 1000);
    },
  },
  methods: {
    ...mapMutations([types.UPDATE]),
  },
};
</script>
<style lang="less">
audio {
  display: none;
}

.view-head-space {
  width: inherit;
  padding-top: 40px;
  padding-bottom: 70px;
}

#app {
  width: 100%;
}
</style>
